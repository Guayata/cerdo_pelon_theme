<style>
#clockdiv{
	display: inline-block;
	font-weight: 100;
	text-align: center;
	font-size: 30px;
}

#clockdiv > div{
	padding: 10px;
	border-radius: 3px;
	display: inline-block;
}

#clockdiv div > span{
	padding: 15px;
	display: inline-block;
}

.smalltext{
	padding-top: 5px;
	font-size: 16px;
}
</style>

<div class="content-page-width content-profile-login">
  <div class="container-fluid page-bienvenidos-tribu" id="step1">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-12">
        <div class="row">
          <div class="container-fluid page-bienvenidos-tribu page-thankyou-tribu">
            <div class="row justify-content-center">
              <div class="col-12 col-lg-9">
                <div class="row text-center ">
                  <div class="col-12">
                    <p class="title">¡BIENVENIDx a nuestra tribu!</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="row justify-content-center">
              <div class="col-12 col-lg-10">
                <div class="slider-people">
                  <div>
                    <img class="img-fluid w-100 lazyload"
                         data-src="{{"people-1.png" | asset_url }}">
                  </div>
                  <div>
                    <img class="img-fluid w-100 lazyload"
                         data-src="{{"people-2.png" | asset_url }}">
                  </div>
                  <div>
                    <img class="img-fluid w-100 lazyload"
                         data-src="{{"people-3.png" | asset_url }}">
                  </div>
                  <div>
                    <img class="img-fluid w-100 lazyload"
                         data-src="{{"people-4.png" | asset_url }}">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row content-contact-form justify-content-center">
          <div class="col-12  box-content-contact">

            <div class="row">
              <div class="col-12">
                <div class="row">
                  <div id="login" class="col-12">
                    <div class="row justify-content-center">
                      <div class="col-12 text-center">      
                        <form action="" id="frmKuLogin" class="row" method="post">
                          <div class="col-12 text-center text-uppercase">
                            <p class="title-login">
                              <span>
                                inicia sesión
                              </span>
                            </p>
                          </div>
                          <div class="col-12 content-input">
                            <input type="email" name="email" maxlength="128" required="required" placeholder="E-mail" class="form-control">
                          </div> 
                          <div class="col-12 content-input">
                            <input type="password" name="pass" maxlength="8" required="required" placeholder="Password" class="form-control">
                          </div> 
                          <div class="col-12  content-button-submit text-center">
                            <button class="btn text-uppercase" type="submit">
                              Entrar
                            </button>
                          </div> 
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid page-bienvenidos-tribu page-thankyou-tribu page-profile-tribu">
    <div id="account" style="display: none;">    
      <div class="row justify-content-center">
        <div class="col-12 col-lg-9">
          <div class="row text-center ">
            <div class="col-12">
              <p class="title">¡Hola, <span id="spfname"></span>!</p>              
              <p class="subtitle">
                <span>
                  Este es tu espacio en Food News,
                </span>
              </p>
              <p class="subtitle">
                <span>
                  ¡gracias por sumarte a compartir buenas noticias!
                </span>
              </p>         
              <p class="title-code">
                TU CÓDIGO ÚNICO ES: <span id="spcode"></span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-12 mt-5">
          <div class="row justify-content-center m-0">
            <div class="col-12 col-lg-12 text-center  box-sell-start">
              <div class="content-box-sell-start row justify-content-center p-4">
                <div class="col-12 col-lg-9">
                  <p class="subtitle-end text-center text-uppercase">
                    ¡HAS GANADO <span id="spganado">$0.0</span> MXN*!
                  </p>
                  <p class="text-uppercase">
                    *Desde que te uniste a la tribu.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="row box-sell-compare-dates m-0">
            <div class="col-12  my-auto">
              <p class="mb-0 title-sec-date text-uppercase">
                registro de ventas
              </p>
            </div>
          </div>
        </div>
        <div class="col-12 table-date-sell">
          <div class="row">
            <div class="col-12 table-responsive">
              <table class="table">
                <tr>
                  <th>Nombre y apellido</th>
                  <th>Fecha</th>
                  <th>Ciudad</th>
                  <th>Monto de compra (MXN)</th>
                </tr>
                <tbody id="rwsVentas">
                </tbody>
              </table>
            </div>
            <div class="col-12">
              <p class="subtitle-end-box text-uppercase text-center my-5">
                Para devengar tu comisión debes alcanzar un monto mínimo de $5,000 MXN. Para más detalles consulta nuestros <a href="/pages/terminos-condiciones" target="_blank">términos y condiciones</a>
              </p>
            </div>
            <div class="col-12">
              <div class="row box-description-sale-bottom m-0">
                <div class="col-12 col-lg-3 mb-3 my-lg-auto text-center text-lg-start box-description-content-txt">
                  VENTAS: <span id="spventas">0</span>
                </div>
                <div class="col-12 col-lg-5 mb-3 my-lg-auto text-center text-lg-start box-description-content-txt">
                  MONTO TOTAL VENDIDO: <span id="sptotal">$0.0</span> MXN
                </div>
                <div class="col-12 col-lg-4 mb-3 my-lg-auto text-center text-lg-start box-description-content-txt">
                  COMISIÓN: <span id="spcomision">$0.0</span> MXN
                </div>
              </div>
            </div>
            <div class="col-12">
              <p class="subtitle-end-box text-uppercase text-center my-5">
                <strong>Bonus!</strong>
              </p>
              <p class="subtitle-end-box text-uppercase text-center mt-0">
                Si se redime tu código de descuento un mínimo de 30 veces en nuestro e-commerce en un plazo de 2 meses, <strong>¡podrás ganar una sorpresa!</strong>
              </p>
            </div>
            <div class="col-12 text-center">
              <div id="clockdiv">
                <div>
                  <span class="days"></span>
                  <div class="smalltext">Días</div>
                </div>
                <div>
                  <span class="hours"></span>
                  <div class="smalltext">Horas</div>
                </div>
                <div>
                  <span class="minutes"></span>
                  <div class="smalltext">Minutos</div>
                </div>
                <div>
                  <span class="seconds"></span>
                  <div class="smalltext">Segundos</div>
                </div>
              </div>
            </div>            
          </div>
        </div>
        <div class="col-12">
          <div id="shopify-section-agradecimiento-tribu" class="shopify-section"><div class="content-page-width">
            <div class="container-fluid page-bienvenidos-tribu page-thankyou-tribu">
              <div class="row justify-content-center">
                <div class="col-12 col-lg-10 box-iconos-section">
                  <div class="row">
                    <div class="col-12">
                      <p class="title-section-icons text-center text-uppercase">
                        <span>Para facilitar tu trabajo de embajadora </span><br>
                        <span> hemos creado este paquete de Contenido food news:</span>
                      </p>
                    </div>
                    <div class="col-12">
                      <div class="row justify-content-center">
                        <div class="col-6 col-lg content-iconos text-center">
                          <div class="content-image">
                            <img class="img-fluid lazyloaded" data-src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-1.png?v=3163995004460766295" src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-1.png?v=3163995004460766295">
                            <p class="description-iconos">
                              Post Food News <br>
                              para Instagram
                            </p>
                          </div>
                        </div>
                        <div class="col-6 col-lg content-iconos text-center">
                          <div class="content-image">
                            <img class="img-fluid lazyloaded" data-src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-2.png?v=6703746303586529582" src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-2.png?v=6703746303586529582">
                            <p class="description-iconos">
                              Post Food News <br>
                              para Facebook
                            </p>
                          </div>
                        </div>
                        <div class="col-6 col-lg content-iconos text-center">
                          <div class="content-image">
                            <img class="img-fluid lazyloaded" data-src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-3.png?v=3058593346495236327" src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-3.png?v=3058593346495236327">
                            <p class="description-iconos">
                              Plantilla de email <br>
                              o mensaje de texto
                            </p>
                          </div>
                        </div>
                        <div class="col-6 col-lg content-iconos text-center">
                          <img class="img-fluid lazyloaded" data-src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-4.png?v=15396840523087351618" src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-4.png?v=15396840523087351618">
                          <div class="content-image">
                            <p class="description-iconos">
                              Fotografías <br>
                              Food News
                            </p>
                          </div>
                        </div>
                        <div class="col-6 col-lg content-iconos text-center">
                          <div class="content-image">
                            <img class="img-fluid lazyloaded" data-src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-5.png?v=16064093850074976832" src="//cdn.shopify.com/s/files/1/0600/9500/4835/t/5/assets/icono-5.png?v=16064093850074976832">
                            <p class="description-iconos">
                              Mensaje gráfico <br>
                              Whatsapp y Messenger
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 text-center content-button-download">
                      <p class="text-uppercase">
                        Da click aquí para descargar un paquete de contenido para
                        facilitarte la promoción de FOOD NEWS en redes y canales sociales.
                      </p>
                      {% if section.settings.button_link != blank %}
                      <a href="{{section.settings.button_link}}" class="btn"  download target="_blank">
                        <span>
                          Descargar
                        </span>
                      </a>
                      {% endif %}
                    </div>
                    <div class="col-12 text-final-box text-center text-uppercase">
                      <p>
                        ¡Gracias por ser parte de la tribu Food News!
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-8 col-lg-6 mt-5">
          <p class="subtitle-end text-center text-uppercase">
            <button id="btnKuLogout" class="btn"><span>CERRAR SESIÓN</span></button>
          </p>
        </div>
      </div>
    </div>       
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  $('body').addClass('page-tribu');
</script>

<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script>     
  const api = "//gsjf60ub30.execute-api.us-east-1.amazonaws.com/production/ambassadors/";
  const eFo = new Intl.NumberFormat('en-US', {style: 'currency',currency: 'USD' });
  const tkn = Cookies.get('kuemtkn');
  
  function getTimeRemaining(endtime) {
    const total = Date.parse(endtime) - Date.parse(new Date());
    const seconds = Math.floor((total / 1000) % 60);
    const minutes = Math.floor((total / 1000 / 60) % 60);
    const hours = Math.floor((total / (1000 * 60 * 60)) % 24);
    const days = Math.floor(total / (1000 * 60 * 60 * 24));

    return {
      total,
      days,
      hours,
      minutes,
      seconds
    };
  }
  function initializeClock(id, endtime) {
    const clock = document.getElementById(id);
    const daysSpan = clock.querySelector('.days');
    const hoursSpan = clock.querySelector('.hours');
    const minutesSpan = clock.querySelector('.minutes');
    const secondsSpan = clock.querySelector('.seconds');

    function updateClock() {
      const t = getTimeRemaining(endtime);

      daysSpan.innerHTML = t.days;
      hoursSpan.innerHTML = ('0' + t.hours).slice(-2);
      minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
      secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

      if (t.total <= 0) {
        clearInterval(timeinterval);
      }
    }

    updateClock();
    const timeinterval = setInterval(updateClock, 1000);
  }
  
  function getVentas(codigo){
    $("#rwsVentas").find('tr').remove();
    fetch(`${api}ventas?code=${codigo}`).then((resp) => resp.json())
    .then(function(r) {
      if(r.status){
        const _g = eFo.format(r.total * 0.1);
        $('#spganado').text(_g);
        $('#spventas').text(r.ventas.length);
        $('#sptotal').text(eFo.format(r.total));
        $('#spcomision').text(_g);
        $("#rwsVentas").find('tr').remove();
        for (var i = 0; i < r.ventas.length; i+=1) {
          const v = r.ventas[i];
          $("#rwsVentas").append(`<tr><td>${v.nombre}</td><td>${v.fecha}</td><td>${v.ciudad}</td><td>${eFo.format(v.total)}</td></tr>`);
        }
      }else{
        alert( `ERROR: ${r.error}` );
      }
    }).catch(function(error) {
      alert(`ERROR: ${error}`);
    });     		
  };   

  function initSession(r){
    $('#step1').hide();
    $('#account').show();   
    $('#spfname').text(r.fname);
    $('#spcode').text(r.codigo);
    getVentas(r.codigo);
    //countdown        
    const d = new Date(r.fin);
    const localTime = d.getTime();
    const localOffset = d.getTimezoneOffset() * 60000;        
    const deadline = new Date(Date.parse(new Date(localTime + localOffset)) + 60 * 24 * 60 * 60 * 1000);
               
  	initializeClock('clockdiv', deadline);    
  }
  
  if(tkn){
    const r = JSON.parse(tkn);
	initSession(r);
  }else{
    $('#account').hide();
    $('#step1').show();			
  }
  $("#btnKuLogout").click(function(e) {
    e.preventDefault();
    Cookies.remove('kuemtkn');
    location.reload();
  });
  $("#frmKuLogin").submit(function(e) {
    e.preventDefault();
    const $f = $(this);
    const $b = $f.find("button[type='submit']");
    const email = $f.find("input[name='email']").val();
    const d = {
      email: email,
      pass: $f.find("input[name='pass']").val()
    };

    $b.prop('disabled', true);
    $.ajax({
      type: "POST",
      url: api + "login",
      data: JSON.stringify(d),
      contentType: "application/json",
      dataType: "json"
    }).done(function(r) {				  				
      if(r.status){
        Cookies.set('kuemtkn', JSON.stringify(r), { expires: 7 });
        initSession(r);
      }else{
        alert( `ERROR: ${r.error}` );
      }
    }).fail(function() {
      alert( "error" );
    }).always(function() {
      $b.prop('disabled', false);
    });
  });
</script>

{% schema %}
{
  "name": "Mi perfil",
  "settings": [
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
  ],
  "presets": [
    {
       "name": "Mi perfil",
      "category": "btn"
    }
  ]
}
{% endschema %}
